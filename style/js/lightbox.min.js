(function ($) {
    $.extend($.fn, {
        simpleLightboxVideo: function () {
            var settings = {
                delayAnimation: 300,
                keyCodeClose: 27
            };
            
            $.simpleLightboxVideo.vars = $.extend({}, settings);
            var elements = this;
            
            elements.click(function () {
                var marginTop = window.innerHeight > 540 ? (window.innerHeight - 540) / 2 : 0;
                
                var videoSite = $(this).data("videosite");
                var videoFrame = '<iframe src="" width="640" height="480" id="slvj-video-embed" style="border:0;"></iframe>';
                var closeButton = '<div id="slvj-close-icon"></div>';
                var lightboxContainer = '<div class="slvj-lightbox" style="margin-top:' + marginTop + 'px">';
                var backgroundOverlay = '<div id="slvj-back-lightbox">';
                var backgroundClose = '<div id="slvj-background-close"></div>';
                var lightboxWindow = '<div id="slvj-window">';
                var closingTags = '</div></div></div>';
                
                $("body").append(lightboxWindow + backgroundClose + backgroundOverlay + lightboxContainer + closeButton + videoFrame + closingTags);
                
                $("#slvj-window").hide();
                
                var videoUrl = "";
                if (videoSite === "youtube") {
                    videoUrl = "https://www.youtube.com/embed/" + $(this).data("videoid") + "?autoplay=1";
                } else if (videoSite === "vimeo") {
                    videoUrl = "https://player.vimeo.com/video/" + $(this).data("videoid") + "?autoplay=1";
                } else if (videoSite === "local") {
                    videoUrl = $(this).data("videoid");
                    videoFrame = '<video width="640" height="480" id="slvj-video-embed" controls preload="metadata" playsinline autoplay>' +
                        '<source src="" type="video/mp4">' +
                        '</video>';
                }
                
                $("#slvj-window").fadeIn();
                if (videoSite === "local") {
                    $("#slvj-video-embed source").attr("src", videoUrl);
                    $("#slvj-video-embed")[0].load();
                } else {
                    $("#slvj-video-embed").attr("src", videoUrl);
                }
                
                $("#slvj-close-icon, #slvj-background-close").click(function () {
                    $("#slvj-window").fadeOut($.simpleLightboxVideo.vars.delayAnimation, function () {
                        $(this).remove();
                    });
                });
                
                return false;
            });
            
            $(document).keyup(function (event) {
                if (event.keyCode === settings.keyCodeClose) {
                    $("#slvj-window").fadeOut($.simpleLightboxVideo.vars.delayAnimation, function () {
                        $(this).remove();
                    });
                }
            });
            
            $(window).resize(function () {
                var marginTop = window.innerHeight > 540 ? (window.innerHeight - 540) / 2 : 0;
                $(".slvj-lightbox").css({ marginTop: marginTop + "px" });
            });
            
            return false;
        }
    });
})(jQuery);

(function ($) {
    $.simpleLightboxVideo = function (options, element) {
        return $(element).simpleLightboxVideo();
    };
})(jQuery);
